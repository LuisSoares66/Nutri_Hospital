{% extends "base.html" %}
{% block content %}
  <h2>Leitura de dados (Hospitais)</h2>

  {% if hospitais|length == 0 %}
    <p class="muted">Nenhum hospital cadastrado ainda.</p>
    <div class="btns" style="margin-top:12px;">
      <a class="btn" href="/registro/hospital">Cadastrar hospital</a>
      <a class="btn secondary" href="/">Voltar</a>
    </div>
  {% else %}
    <div class="card" style="margin-bottom:12px;">
      <label for="busca"><b>Buscar</b> (filtra em todos os campos)</label>
      <input id="busca" type="text" placeholder="Digite para filtrar... (ex: nome, cidade, ONA, bionexo)" />
      <div class="muted" id="contador" style="margin-top:6px;"></div>
    </div>

    <div class="table-wrap">
      <table id="tabelaHospitais" class="data-table">
        <thead>
          <tr>
            <th>Ações</th>

            <th>ID</th>
            <th>Criado em</th>

            <th>Nome do hospital</th>
            <th>Cidade</th>
            <th>UF</th>
            <th>Telefone</th>

            <th>Contato 1</th>
            <th>Contato 2</th>
            <th>Contato 3</th>

            <th>Especialidade</th>
            <th>Leitos</th>
            <th>UTI</th>

            <th>Certificações</th>
            <th>Convênio</th>
            <th>Modelo compras</th>
          </tr>
        </thead>
        <tbody>
          {% for h in hospitais %}
            <tr class="data-row">
              <td class="nowrap">
                <a class="btn secondary" href="/hospital/{{h.id}}" style="padding:6px 10px; font-size:14px;">
                  Abrir
                </a>
                <a class="btn" href="/hospital/{{h.id}}/produtos" style="padding:6px 10px; font-size:14px;">
                  Produtos
                </a>
              </td>

              <td class="nowrap">{{h.id}}</td>
              <td class="nowrap">{{h.created_at}}</td>

              <td class="wrap"><b>{{h.nome_hospital}}</b></td>
              <td class="nowrap">{{h.cidade}}</td>
              <td class="nowrap">{{h.estado}}</td>
              <td class="nowrap">{{h.telefone}}</td>

              <td class="wrap">
                {{h.contato1_nome}} | {{h.contato1_funcao}} | {{h.contato1_telefone}}
              </td>
              <td class="wrap">
                {{h.contato2_nome}} | {{h.contato2_funcao}} | {{h.contato2_telefone}}
              </td>
              <td class="wrap">
                {{h.contato3_nome}} | {{h.contato3_funcao}} | {{h.contato3_telefone}}
              </td>

              <td class="wrap">{{h.especialidade}}</td>
              <td class="nowrap">{{h.leitos}}</td>
              <td class="nowrap">{{h.leitos_uti}}</td>

              <td class="wrap">{{h.certificacoes}}</td>
              <td class="nowrap">{{h.tem_convenio}}</td>
              <td class="wrap">{{h.modelo_compras}}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <style>
      .table-wrap{
        border:1px solid #ddd;
        border-radius:10px;
        overflow:auto;
        max-height: 70vh;
        background: #fff;
      }
      .data-table{
        border-collapse:collapse;
        width:100%;
        min-width: 1900px;
      }
      .data-table th, .data-table td{
        border:1px solid #ddd;
        padding:8px;
        vertical-align:top;
        font-size: 16px;
      }
      .data-table thead th{
        position: sticky;
        top: 0;
        z-index: 2;
        background:#f3f3f3;
      }
      .nowrap{ white-space:nowrap; }
      .wrap{ white-space:pre-wrap; word-break:break-word; }
      .hidden-row{ display:none; }
    </style>

    <script>
      (function(){
        const input = document.getElementById("busca");
        const rows = Array.from(document.querySelectorAll("#tabelaHospitais tbody tr"));
        const contador = document.getElementById("contador");

        function normalize(s){
          return (s || "").toString().toLowerCase()
            .normalize("NFD").replace(/[\u0300-\u036f]/g, "");
        }

        function atualizarContador(visiveis){
          contador.textContent = `${visiveis} de ${rows.length} registro(s) exibido(s).`;
        }

        function filtrar(){
          const q = normalize(input.value.trim());
          let vis = 0;
          rows.forEach(tr => {
            const text = normalize(tr.innerText);
            const ok = q === "" || text.includes(q);
            tr.classList.toggle("hidden-row", !ok);
            if(ok) vis++;
          });
          atualizarContador(vis);
        }

        input.addEventListener("input", filtrar);
        atualizarContador(rows.length);
      })();
    </script>
  {% endif %}

  <div class="btns" style="margin-top:12px;">
    <a class="btn" href="/relatorios">Relatórios</a>
    <a class="btn secondary" href="/">Voltar</a>
  </div>
{% endblock %}
