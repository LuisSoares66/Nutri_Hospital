{% extends "base.html" %}
{% block content %}
<div class="container">

  <h1>PRODUTOS – {{ hospital.nome_hospital }}</h1>

  <div class="btns" style="margin-bottom:12px;">
    <a class="btn secondary" href="{{ url_for('main.hospitais') }}">⬅ Voltar</a>
  </div>

  <div class="card">
    <h2>{% if produto_edit %}Editar produto{% else %}Adicionar produto{% endif %}</h2>

    <form method="POST" action="{{ url_for('main.produtos_hospital', hospital_id=hospital.id) }}">
      <input type="hidden" name="produto_id" value="{{ produto_edit.id if produto_edit else '' }}">

      <label>Marca</label>
      <select name="marca_planilha">
        {% set marca = produto_edit.marca_planilha if produto_edit else '' %}
        <option value="" {% if marca=='' %}selected{% endif %}>—</option>
        <option value="PRODIET" {% if marca=='PRODIET' %}selected{% endif %}>PRODIET</option>
        <option value="NESTLÉ" {% if marca=='NESTLÉ' %}selected{% endif %}>NESTLÉ</option>
        <option value="DANONE" {% if marca=='DANONE' %}selected{% endif %}>DANONE</option>
        <option value="FRESENIUS" {% if marca=='FRESENIUS' %}selected{% endif %}>FRESENIUS</option>
      </select>

      <label>Produto</label>
      <input name="produto" value="{{ produto_edit.produto if produto_edit else '' }}" required>

      <label>Quantidade</label>
      <input name="quantidade" value="{{ produto_edit.quantidade if produto_edit else '' }}" placeholder="0">

      <div class="btns">
        <button class="btn" type="submit">Salvar</button>

        {% if produto_edit %}
          <a class="btn secondary" href="{{ url_for('main.produtos_hospital', hospital_id=hospital.id) }}">
            Cancelar edição
          </a>
        {% endif %}
      </div>
    </form>
  </div>

  <div class="card" style="margin-top:14px;">
    <h2>Produtos cadastrados</h2>

    {% if produtos %}
      <table class="table">
        <thead>
          <tr>
            <th>Marca</th>
            <th>Produto</th>
            <th>Qtd</th>
            <th style="width:220px;">Ações</th>
          </tr>
        </thead>
        <tbody>
          {% for p in produtos %}
          <tr>
            <td>{{ p.marca_planilha or '' }}</td>
            <td>{{ p.produto }}</td>
            <td>{{ p.quantidade }}</td>
            <td style="display:flex; gap:8px; flex-wrap:wrap;">
              <a class="btn secondary"
                 href="{{ url_for('main.produtos_hospital', hospital_id=hospital.id, edit_id=p.id) }}">
                Editar
              </a>

              <form method="POST"
                    action="{{ url_for('main.excluir_produto', hospital_id=hospital.id, produto_id=p.id) }}"
                    onsubmit="return confirm('Excluir este produto?');"
                    style="display:inline;">
                <button class="btn danger" type="submit">Excluir</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p>Nenhum produto cadastrado.</p>
    {% endif %}
  </div>

</div>
{% endblock %}
