{% extends "base.html" %}
{% block content %}

<div class="container">
  <h1>Produtos – {{ hospital.nome_hospital }}</h1>

  <a class="btn secondary" href="{{ url_for('main.hospitais') }}">⬅ Voltar</a>

  <hr>

  <h2>Adicionar produto</h2>

  <form method="POST">
    <div style="max-width:700px; display:grid; gap:12px;">

      <!-- MARCA -->
      <label><b>Marca</b></label>
      <select id="marcaSelect" name="marca_planilha" required>
        <option value="">-- selecione a marca --</option>
        {% for m in catalogo | map(attribute='marca') | unique %}
          <option value="{{ m }}">{{ m }}</option>
        {% endfor %}
      </select>

      <!-- PRODUTOS (ROLAGEM) -->
      <label><b>Produto</b></label>
      <select id="produtoSelect" name="produto" size="10" required>
        <!-- preenchido via JS -->
      </select>

      <label><b>Quantidade</b></label>
      <input type="number" name="quantidade" min="0" value="0" required>

      <button class="btn primary">+ Adicionar</button>
    </div>
  </form>

  <hr>

  <h2>Produtos cadastrados</h2>

  {% if produtos %}
    <table class="table">
      <thead>
        <tr>
          <th>Marca</th>
          <th>Produto</th>
          <th>Qtd</th>
        </tr>
      </thead>
      <tbody>
        {% for p in produtos %}
        <tr>
          <td>{{ p.marca_planilha }}</td>
          <td>{{ p.produto }}</td>
          <td>{{ p.quantidade }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p>Nenhum produto cadastrado.</p>
  {% endif %}
</div>

<!-- ========================= -->
<!-- SCRIPT DE FILTRO -->
<!-- ========================= -->
<script>
  const catalogo = {{ catalogo | tojson }};
  const marcaSelect = document.getElementById("marcaSelect");
  const produtoSelect = document.getElementById("produtoSelect");

  marcaSelect.addEventListener("change", function () {
    const marca = this.value;
    produtoSelect.innerHTML = "";

    if (!marca) return;

    const filtrados = catalogo.filter(p => p.marca === marca);

    filtrados.forEach(p => {
      const opt = document.createElement("option");
      opt.value = p.produto;
      opt.textContent = p.produto;
      produtoSelect.appendChild(opt);
    });
  });
</script>

{% endblock %}
